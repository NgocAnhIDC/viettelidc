<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI TT Cloud - Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #00458b 0%, #1e3c72 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-left i {
            font-size: 24px;
            margin-right: 15px;
        }

        .header-left h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .main-content {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .welcome-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .welcome-section h2 {
            color: #00458b;
            margin-bottom: 15px;
        }

        .welcome-section p {
            color: #666;
            line-height: 1.6;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .action-card i {
            font-size: 48px;
            color: #00458b;
            margin-bottom: 15px;
        }

        .action-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .action-card p {
            color: #666;
            font-size: 14px;
        }

        .stats-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .stats-section h3 {
            color: #00458b;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-item .number {
            font-size: 32px;
            font-weight: bold;
            color: #00458b;
            margin-bottom: 5px;
        }

        .stat-item .label {
            color: #666;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .loading i {
            font-size: 32px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <i class="fas fa-chart-line"></i>
            <h1>KPI TT Cloud Dashboard</h1>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <div id="userName">Loading...</div>
                    <div id="userRole" style="font-size: 12px; opacity: 0.8;">Loading...</div>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Đăng xuất
            </button>
        </div>
    </div>

    <div class="main-content">
        <div class="welcome-section">
            <h2>Chào mừng đến với KPI TT Cloud</h2>
            <p>Hệ thống đo hiệu suất TT Cloud giúp bạn quản lý và theo dõi hiệu suất làm việc của các team một cách hiệu quả. 
            Sử dụng các tính năng bên dưới để bắt đầu quản lý KPI và hiệu suất của tổ chức.</p>
        </div>

        <div class="quick-actions">
            <a href="User-Management.html" class="action-card">
                <i class="fas fa-users"></i>
                <h3>Quản lý người dùng</h3>
                <p>Quản lý tài khoản, phân quyền và thông tin người dùng trong hệ thống</p>
            </a>

            <a href="Task-Management.html" class="action-card">
                <i class="fas fa-tasks"></i>
                <h3>Quản lý công việc</h3>
                <p>Theo dõi và quản lý các nhiệm vụ, công việc của từng team và cá nhân</p>
            </a>

            <a href="KPI-Dashboard.html" class="action-card">
                <i class="fas fa-chart-bar"></i>
                <h3>Báo cáo KPI</h3>
                <p>Xem báo cáo hiệu suất, thống kê và phân tích KPI của các team</p>
            </a>

            <a href="Settings.html" class="action-card">
                <i class="fas fa-cog"></i>
                <h3>Cài đặt hệ thống</h3>
                <p>Cấu hình hệ thống, quản lý roles, teams và các thiết lập khác</p>
            </a>
        </div>

        <div class="stats-section">
            <h3>Thống kê tổng quan</h3>
            <div class="stats-grid" id="statsGrid">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Đang tải dữ liệu...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class DashboardManager {
            constructor() {
                this.API_BASE = this.getApiBase();
                this.checkAuth();
                this.loadUserInfo();
                this.loadStats();
            }

            getApiBase() {
                const hostname = window.location.hostname;
                const protocol = window.location.protocol;
                
                if (hostname === 'localhost' || hostname === '127.0.0.1') {
                    return `${protocol}//${hostname}:3001/api`;
                } else {
                    return `${protocol}//${hostname}/api`;
                }
            }

            checkAuth() {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    window.location.href = 'production-index.html';
                    return;
                }

                // Validate token
                this.validateToken(token);
            }

            async validateToken(token) {
                try {
                    const response = await fetch(`${this.API_BASE}/auth/validate`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!response.ok) {
                        localStorage.clear();
                        window.location.href = 'production-index.html';
                    }
                } catch (error) {
                    console.error('Token validation failed:', error);
                    localStorage.clear();
                    window.location.href = 'production-index.html';
                }
            }

            loadUserInfo() {
                const userFullData = localStorage.getItem('userFullData');
                if (userFullData) {
                    const user = JSON.parse(userFullData);
                    document.getElementById('userName').textContent = user.fullName || user.username;
                    document.getElementById('userRole').textContent = user.roles ? user.roles.join(', ') : 'User';
                }
            }

            async loadStats() {
                try {
                    const token = localStorage.getItem('authToken');
                    
                    // Load users count
                    const usersResponse = await fetch(`${this.API_BASE}/users`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    let userCount = 0;
                    if (usersResponse.ok) {
                        const usersData = await usersResponse.json();
                        userCount = usersData.total || 0;
                    }

                    // Mock other stats for now
                    const stats = [
                        { number: userCount, label: 'Người dùng' },
                        { number: '14', label: 'Teams' },
                        { number: '0', label: 'Nhiệm vụ' },
                        { number: '85%', label: 'Hiệu suất trung bình' }
                    ];

                    this.renderStats(stats);

                } catch (error) {
                    console.error('Failed to load stats:', error);
                    this.renderStats([
                        { number: '5', label: 'Người dùng' },
                        { number: '14', label: 'Teams' },
                        { number: '0', label: 'Nhiệm vụ' },
                        { number: '85%', label: 'Hiệu suất trung bình' }
                    ]);
                }
            }

            renderStats(stats) {
                const statsGrid = document.getElementById('statsGrid');
                statsGrid.innerHTML = stats.map(stat => `
                    <div class="stat-item">
                        <div class="number">${stat.number}</div>
                        <div class="label">${stat.label}</div>
                    </div>
                `).join('');
            }
        }

        function logout() {
            if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
                localStorage.clear();
                window.location.href = 'production-index.html';
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            new DashboardManager();
        });
    </script>
</body>
</html>
